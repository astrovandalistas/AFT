<!DOCTYPE html>
<html>
  <head>
    <title>An Argument For Technology</title>
    <link rel="stylesheet" href="./css/main.css" />
    <link
      rel="shortcut icon"
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAGu0lEQVR42uWaSUxTXRTHz2sZjEPioompgQSMSTWYFo00LRopoiYmRhZqqkJg4YYFhpgoLhyCogt0ZUOIArrBaFpjF7KQYBBwQIJYSGvBVwzpgAzSQYsWWvo43+LLh/JR6htpbU/yFk16zz3n9+59957/vQQAICSxpQjdQXZ2Nmg0GkBkxpmiKGhpaVkVCCjko1AokI05HA4UOjYAQJHQdEdGRli1CwaDq/L2BQcQCATg+/fvjNt5vd7EAAAAMDMzk7wjAAAgFAoxbkNRVOIAmJiYYDV1knoETE1NJQ4At9vNuM3s7GxyA/D5fIkDgM0yOD4+njgAxsbGGLfxeDzJPQU+fPiwagWR4Pvtbdu2MaoDKIpCsVicGLUAAMDo6CjjJTBmG6GzZ89CaWkp7/sAJnN6fn6e90TLysqgqqrqz1PAarUiIqLT6cTm5mZUKpW8DDWn00l7CvT09PDS55EjR9BgMOD4+DgiIn7+/DnS/379yM/PXxZMKBRCk8mEly5dwjVr1rAOxmaz0QbQ0dHBup+dO3fivXv3VuzvwIEDKwNobGyMGpjP50Oj0YiHDx9mHNjr169pA7h//z4j36mpqVhdXY29vb0YDAaj+n7w4MHKAD5+/Eg7SLPZjDU1NZienk4ryI6ODtq+6+rqaPksKChAvV6PU1NTtH0PDw9HBqBSqZCiKMbSlcfjwYcPH6JarY4abEtLC22fFRUVK/ohCALPnTuHvb29OD8/z0puKygoWA6goaEBuVgwGMTu7m4sKSmJGHh9fT1tXxqNZln7zMxMrK+vR5fLhVytqalpOQCLxYJ8mcViwaqqqiUJXL9+nVbbhYWFJdMqLy8PDQYD+v1+3uKzWq1LASiVSgyHw8i3kSSJ1dXVCABYUVFBq82XL18QAPDgwYPY3t7+x48aW8vPz/8FQKfToZBms9mwtraW1n9dLhd2dnZiKBQSNKaGhoZfAPgc/n+LWSyWfz+qu3fvxnfv3kFKSgokk1EUBWq1GkQlJSVJlzwAgFgshtLSUhAVFRVBslphYSGIN27cWOP3+wERYf369ZCamprwic/OzsLg4CA8f/4cCPjteHzt2rWg1WpBrVaDQqGALVu2gEQiSYikvV4vmEwmePv2LTQ3Ny/KdEsA/N8IgoCioiLQaDSwa9cukMlkkJWVBSKRKO4TDgaDYLPZYGBgANra2sBgMEQUWaICiGRSqRROnDgBSqUS5HI5ZGVlwYYNG2KesNvtBofDAVarFbq6ukCv19M6XWIMYJmkJBJBcXEx7Nu3D+RyOWzfvh2kUqlgiYbDYZicnAS73Q52ux1IkoSXL19CT08PK3+cAUQyhUIBR48ehUOHDsHevXs5DeNnz57B5OQkOBwOMJvN0NnZCeFwOP5V4fLycvR6vZx3bGazGbOzs4VUhvl3WlZWht++feNt2zo0NIQ7duz4OwBotVpe3nykyjI3Nze+ARQXF+P09LRgBQxJkiiXy+MTgEqlYqTNsbXh4WGUyWTxBWDr1q346dMnxsn09/ezLmWlUml8AEhPT0ez2cw4Cb/fjzk5OTgwMMAKgslkwrS0tNgDaGtrY5XAf/r8sWPHWMte7e3tsQXw6NEjVoF7vV7MyMhY9NPa2sr6m/DkyZPYALhx4wbroHU63RJfMpkM3W43a3937txZXQBnzpzBubk5VsGOjY1FPE26ffs2awChUAivXLmyOgAKCws5rfVXr15d0TcXcTYQCOCpU6eEBZCZmYkkSXJWYqPtIrmcA3z9+vV3vZ9fAARBMDrhjXTtpby8/I/9PH36lPNGafPmzfwD0Ov1nAKje+afkZGBExMTnPrq7u7mFwDdc72V7MePH6hSqWgHdfHiRc5bZr1ezw8ArVaLgUCAUzCNjY2MP05dXV2c+lxYWMBr165xA5Cbm7t4v4atOZ1OXLduHWMASqUSfT4fp74DgQCePHmS/TU5j8cDg4ODnOSmuro6+PnzJ+N2fX190NTUxKlvkiTB5XJxl8Rqa2txZmaG8Rt48eIF5736+/fvWV3WuHv3LhIEwd8qsH//fkZ3iNxuNy/ixZ49exjBt9vtePr0aWE2QmKxGB8/fkzr7P7mzZu8iRa3bt2ilXxraytu2rRJ+FqgsrIyqvrDcB2m9bx58ybqaLt8+fLqVoM5OTn46tWrZcFMT08LoduhQqGIWIP09/djXl5e7AQRnU63WBmGw2G8cOGCYBr++fPnF6/Gzc3N/X7NJbaa4PHjx3FkZASNRqPg19uNRiOOjo6iVquNL1VYIpHwpdFFfdLS0lAikfDmT5Czwb/J/gEIXCDudbnr/QAAAABJRU5ErkJggg=="
    />
  </head>
  <body>
    <div id="modal">
      <div id="modal-text" class="styled-text"></div>
    </div>
    <div class="container">
      <div id="word0" class="word styled-text"></div>
      <div id="word1" class="word styled-text"></div>
    </div>
    <div class="container">
      <div class="container-row">
        <div id="word2" class="word styled-text word4"></div>
        <div id="word3" class="word styled-text word4"></div>
      </div>
      <div class="container-row">
        <div id="word4" class="word styled-text word4"></div>
        <div id="word5" class="word styled-text word4"></div>
      </div>
    </div>
    <script src="./js/ajax-utils.js"></script>
    <script src="./js/phrases.js"></script>

    <script>
      const phrases = PHRASES["es"];
      const PHRASES_LIMIT = 16;
      const TWITTER_SERVICE_URL = "https://aftwitterstream.onrender.com/AFT";
      const timeouts = [null, null, null, null, null, null];
      const currentWordIndex = [];
      const currentPhrase = [];
      const wordEls = [];
      var insertIndex = 0;

      window.onload = function () {
        getInitialTweets();
        setTimeout(updateConversationFormat, 20e3);
      };

      function getInitialTweets() {
        ajaxGet(TWITTER_SERVICE_URL + "ALL", function (tweetPhrases) {
          phrases.length = 0;
          tweetPhrases.split("<br>").forEach((p) => {
            if (p.length > 0 && phrases.length < PHRASES_LIMIT) {
              phrases.push(p);
            }
          });

          for (let i = 0; i < timeouts.length; i++) {
            currentPhrase.push(phrases[i].split(" "));
            currentWordIndex.push(0);
            wordEls.push(document.getElementById("word" + i));
            setWord(i)();
            if (i > 1) setWordOpacity(wordEls[i], 0);
          }

          setTimeout(getTweet, 30e3);
        });
      }

      function getTweet() {
        ajaxGet(TWITTER_SERVICE_URL, function (tweetPhrase) {
          console.log("got: " + tweetPhrase);

          if (phrases.length < PHRASES_LIMIT) {
            phrases.push(tweetPhrase + " &nbsp;");
          } else if (phrases.length > PHRASES_LIMIT) {
            phrases = phrases.slice(0, PHRASES_LIMIT);
          } else {
            phrases[insertIndex] = tweetPhrase + " &nbsp;";
            insertIndex = (insertIndex + 1) % phrases.length;
          }
        });
        setTimeout(getTweet, 30e3);
      }

      function setWord(i) {
        return function () {
          document.getElementById("word" + i).innerHTML =
            currentPhrase[i][currentWordIndex[i]];
          let tWord = document.getElementById("word" + i).innerHTML;
          let oWord = document.getElementById("word" + ((i + 1) % 2)).innerHTML;
          let timeoutValue = 80 + 200 * Math.random() + 80 * tWord.length;

          if (i < 2 && tWord == oWord) {
            document.getElementById("modal-text").innerHTML =
              currentPhrase[i][currentWordIndex[i]];
            document.getElementById("modal").style.opacity = 1;
            for (let t = 0; t < 2; t++) {
              if (timeouts[t] != null) {
                clearTimeout(timeouts[t]);
              }
              timeouts[t] = setTimeout(setWord(t % 2), 700);
              setTimeout(function () {
                document.getElementById("modal").style.opacity = 0;
              }, 700);
            }
          } else {
            timeouts[i] = setTimeout(setWord(i), timeoutValue);
          }

          currentWordIndex[i] = currentWordIndex[i] + 1;
          if (currentWordIndex[i] >= currentPhrase[i].length) {
            currentPhrase[i] =
              phrases[Math.floor(phrases.length * Math.random())].split(" ");
            currentWordIndex[i] = 0;
          }
        };
      }

      function setWordOpacity(el, v) {
        el.style.opacity = `${v}`;
      }

      function updateConversationFormat() {
        const rand = Math.random();
        wordEls.forEach((e) => {
          setWordOpacity(e, 0);
        });

        if (rand < 0.25) {
          setWordOpacity(wordEls[0], 1);
          setWordOpacity(wordEls[1], 1);
        } else if (rand < 0.5) {
          setWordOpacity(wordEls[2], 1);
          setWordOpacity(wordEls[3], 1);
          setWordOpacity(wordEls[4], 1);
          setWordOpacity(wordEls[5], 1);
        } else if (rand < 0.75) {
          setWordOpacity(wordEls[0], 1);
          setWordOpacity(wordEls[4], 1);
          setWordOpacity(wordEls[5], 1);
        } else {
          setWordOpacity(wordEls[1], 1);
          setWordOpacity(wordEls[2], 1);
          setWordOpacity(wordEls[3], 1);
        }

        setTimeout(updateConversationFormat, 10e3 + 30e3 * Math.random());
      }
    </script>
  </body>
</html>
